#include <iostream>
#include <fstream>
#include <sstream>
int main()
{
    int done = 0;

    /* Open templorary file */
    FILE *newfp = fopen("file.tmp", "a");
    if (newfp != NULL) 
    {
        /* Open exiting file */
        FILE *oldfp = fopen(fname, "r");
        if(oldfp != NULL)
        {
            ssize_t read;
            size_t len = 0;
            char * line = NULL;

            /* Line-by-line read from exiting file */            
            while ((read = getline(&line, &len, oldfp)) != -1) 
            {
                if(strstr(line, oldline) == NULL) fprintf(newfp, "%s", line);
                else fprintf(newfp, "%s", newline);
            }

            /* Clean up memory */
            fclose(oldfp);
            if (line) free(line);

            done = 1;
        }

        fclose(newfp);
        remove(fname);
        rename("file.tmp", fname);

        return done;
    }
    
    return 0;
}
